# 第十章 内部类

可以将一个类的定义放到另一个类的内部，这就是内部类。

内部类自动拥有对其外围类**所有成员**的访问权（所有的方法和字段，包括 private 修饰的）。

#### **非 static内部类**

其对象只能在与其外围类的对象相关联的情况下才能被创建。

#### **.this**

在内部类中，要生成对外部类的引用，用 “ 外部类名.this ”

#### **.new**

```
Outer.Inner inner = outer.new Inner();		// 为了告知某些其他对象，去创建其某个内部类的对象
```

#### 内部类与向上转型

内部类——某个接口的实现——能够完全不可见（设为 private），并且不可用，从客户端得到的只是指向接口或基类的引用，所以能够很方便地隐藏实现细节。

#### 1. 局部内部类（方法内部类）

该内部类属于该方法，而不是该类。所以，由外围类对象的引用调用该方法即可，跟调用普通方法一样。

一般，该方法的返回值类型是接口或基类型，return 内部类型（向上转型）。

#### 2. 任意作用域内嵌入内部类

比如嵌在 if 语句的作用域内。在定义该内部类的作用域外，它是不可用的；除此之外，跟普通类一样。

#### 3.匿名内部类

```
基类型/接口	方法名（参数列表）{
	return new 基类型/接口{}；
}
```

> 工厂方法中使用匿名内部类来代替专门创建具体工厂类，作为一个 static 域。很方便。

#### 4.嵌套类（static，可以被多层嵌套）

- 要创建嵌套类的对象，并不需要其外围类的对象。
- 不能从嵌套类的对象中访问非静态的外围类对象。

与普通内部类的区别：

- 普通的内部类对象隐式地保存了一个引用，指向创建它的外围类对象（.this）；嵌套类没有。
- 普通内部类的字段与方法，只能放在类的外部层次上，所以普通内部类不能有 static 数据和 static 字段，也不能包含嵌套类；而嵌套类可以包含所有这些东西。

**接口内部的类**

嵌套类可以作为接口的一部分。（可以作为公共代码被这个接口的所有实现所共用）

#### 为什么需要内部类？

*每个内部类都能独立地继承自一个（接口的）实现，所以无论外围类是否已经被继承了某个（接口的）实现，对于内部类都没有影响。*

内部类允许继承多个非接口类型（类或抽象类），实现多重继承。 

#### 闭包与回调

内部类是面向对象的闭包（closure）。
